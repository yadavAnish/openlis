<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
<!-- Data specific to both HaitiLNSP and HaitiClinical-->
<changeSet author="paulsc" id="1" context="haiti,haitiLNSP">
             <comment>Adds the sample initial condition reasons to dictionary</comment>
             <loadData file="HaitiCommon/initialConditions.csv" schemaName="clinlims" tableName="dictionary">
                       <column name="id" header="id" type="NUMERIC"/>
                       <column name="is_active" header="is_active" type="STRING"/>
                       <column name="dict_entry" header="entry" type="STRING"/>
                       <column name="lastupdated" header="lastupdated" type="DATE"/>
                       <column name="local_abbrev" header="local_abbrev" type="STRING"/>
                       <column name="dictionary_category_id" header="category_id" type="NUMERIC"/>
                       <column name="display_key" header="display_key" type="STRING"/>
             </loadData>
</changeSet>
<changeSet author="paulsc" id="2" context="haiti,haitiLNSP">
           <comment>Adds a observation history type of initial sample condition</comment>
           <insert schemaName="clinlims" tableName="observation_history_type">
                   <column name="id" valueNumeric=" nextval( 'observation_history_type_seq' ) "/>
                   <column name="type_name" value="initialSampleCondition"/>
                   <column name="description" value="The condition of the sample when it was delievered to the lab"/>
                   <column name="lastupdated" value=" now() "/>
           </insert>
</changeSet>
<changeSet author="paulsc" id="3" context="haiti,haitiLNSP">
           <comment>Adding display key to organization type referring clinic</comment>
           <update schemaName="clinlims" tableName="organization_type">
                   <column name="name_display_key" value="organization.type.referral.in.lab"/>&gt;
                   <where>short_name='referring clinic'</where>
           </update>
</changeSet>
<changeSet author="paulsc" id="4" context="haiti,haitiLNSP">
           <comment>remove unused organiztion_type Refering lab</comment>
           <delete schemaName="clinlims" tableName="organization_type">
                   <where>short_name='Refering lab'</where>
           </delete>
</changeSet>
<changeSet author="paulsc" id="5" context="haiti,haitiLNSP">
           <comment>Added Department as part of the patient address</comment>
           <insert schemaName="clinlims" tableName="patient_identity_type">
                   <column name="id" valueNumeric=" nextval( 'patient_identity_type_seq' ) "/>
                   <column name="identity_type" value="ADDRESS_DEPT"/>
                   <column name="description" value="The geo-political department address part"/>
                   <column name="lastupdated" valueDate=" now() "/>
           </insert>
</changeSet>
<changeSet author="paulsc" id="6" context="haiti,haitiLNSP">
       <comment>Adding organizations for clinic referrals</comment>
       <loadData file="HaitiCommon/HaitiClinicOrg.csv" schemaName="clinlims" tableName="organization">
            <column name="id" header="id" type="NUMERIC"/>
			<column name="name" header="name"  type="STRING" />
			<column name="short_name" header="short_name"  type="STRING" />
			<column name="lastupdated" header="lastupdated" type="DATE"/>
			<column name="is_active" header="active" type="STRING"/>
       </loadData>
       <loadData file="HaitiCommon/HaitiClinicOrgOrgType.csv" schemaName="clinlims" tableName="organization_organization_type">
            <column name="org_id" header="org_id" type="NUMERIC"/>
			<column name="org_type_id" header="org_type_id"  type="NUMERIC" />
       </loadData>
</changeSet>
 <changeSet author="paulsc" id="7" context="haiti,haitiLNSP">
             <comment>Bug fix: The requester type for sample requester had been hard coded to 1, it should have been set to provider</comment>
             <update schemaName="clinlims" tableName="sample_requester">
                     <column name="requester_type_id" valueNumeric=" ( select id from clinlims.requester_type where requester_type = 'provider' ) "/>
                     <where>requester_type_id=1</where>
             </update>
  </changeSet>
  <changeSet author="paulsc" id="8" context="haiti,haitiLNSP">
             <comment>fix the display keys for the initial sample conditions</comment>
             <sql>
             update clinlims.dictionary set display_key=trim(both ' ' from display_key) where display_key like '%dictionary%';
             </sql>
  </changeSet>
  <changeSet author="nixonl" id="1" context="haitiLNSP">
        <comment>Configuring tests to correct test section</comment>
        <update schemaName="clinlims" tableName="test">
            <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Bacteria' ) "/>
        	<where>test_section_id = ( select id from clinlims.test_section where name = 'ECBU' )</where>
        </update>
        <update schemaName="clinlims" tableName="test">
            <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Immunology' ) "/>
        	<where>test_section_id = ( select id from clinlims.test_section where name = 'VCT' )</where>
        </update>
        <update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'T3'</where>
        </update>
        <update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'T4'</where>
        </update>
        <update schemaName="clinlims" tableName="test">
            <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'TSH'</where>
        </update>
        <update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'Prolactine'</where>
        </update>
        <update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'FSH'</where>
        </update>
        <update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'LH'</where>
        </update>
         <update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'ASAT 30C'</where>
        </update>
        <update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'ASAT 37C'</where>
        </update>
        <update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'ALAT 30C'</where>
        </update>
        <update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'ALAT 37C	'</where>
        </update>
        <update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'Oestrogene'</where>
        </update>
        <update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'Progesterone'</where>
        </update>
  </changeSet>
  <changeSet author="nixonl" id="2" context="haiti,haitiLNSP">
        <comment>Removing duplicate sampletype to test mapping </comment>   
            <sql>
            delete from clinlims.sampletype_test where id in ( select min(id) from clinlims.sampletype_test where test_id= ( select id from clinlims.test where local_abbrev = 'Cyto - Levures' )  and sample_type_id =  ( select id from clinlims.type_of_sample where description = 'Secretion Urethrale' ) )
            </sql>
  </changeSet>
  <changeSet author="paulsc" id="9" context="haiti,haitiLNSP">
             <comment>Adding display keys to the test section table</comment>
             <update schemaName="clinlims" tableName="test_section">
                     <column name="display_key" value="test.section.biochemistry"/>
                     <where>name='Biochemistry'</where>
             </update>
             <update schemaName="clinlims" tableName="test_section">
                     <column name="display_key" value="test.section.hematology"/>
                     <where>name='Hematology'</where>
             </update>
             <update schemaName="clinlims" tableName="test_section">
                     <column name="display_key" value="test.section.bacteria"/>
                     <where>name='Bacteria'</where>
             </update>
             <update schemaName="clinlims" tableName="test_section">
                     <column name="display_key" value="test.section.parasitology"/>
                     <where>name='Parasitology'</where>
             </update>
             <update schemaName="clinlims" tableName="test_section">
                     <column name="display_key" value="test.section.immunology"/>
                     <where>name='Immunology'</where>
             </update>
             <update schemaName="clinlims" tableName="test_section">
                     <column name="display_key" value="test.section.ECBU"/>
                     <where>name='ECBU'</where>
             </update>
             <update schemaName="clinlims" tableName="test_section">
                     <column name="display_key" value="test.section.VCT"/>
                     <where>name='VCT'</where>
             </update>
             <update schemaName="clinlims" tableName="test_section">
                     <column name="display_key" value="test.section.virologie"/>
                     <where>name='Virologie'</where>
             </update>
  </changeSet>
  <changeSet author="nioxnl" id="3" context="haitiLNSP">
           <comment>Fixing nixonl:1</comment>
    	<update schemaName="clinlims" tableName="test">
        	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Biochemistry' ) "/> 
        	<where>description = 'ALAT 37C'</where>
        </update>
  </changeSet>
  <changeSet author="paulsc" id="10" context="haiti,haitiLNSP">
             <comment>Adds haiti department names to the dictionary</comment>
             <insert schemaName="clinlims" tableName="dictionary_category">
                     <column name="id" valueNumeric="  nextval( 'dictionary_category_seq' ) "/>
                     <column name="description" value="haitiDepartment"/>
                     <column name="lastupdated" valueDate=" now() "/>
                     <column name="local_abbrev" value="haitDept"/>
                     <column name="name" value="haitDepartments"/>
             </insert>
             <insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>
                     <column name="dict_entry" value="Ouest"/>
                     <column name="lastupdated" valueDate=" now() "/>
                     <column name="dictionary_category_id"
                             valueNumeric=" (select id from clinlims.dictionary_category where description = 'haitiDepartment' ) " />
             </insert><insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>
                     <column name="dict_entry" value="Nord"/>
                     <column name="lastupdated" valueDate=" now() "/>
                     <column name="dictionary_category_id"
                             valueNumeric=" (select id from clinlims.dictionary_category where description = 'haitiDepartment' ) " />
             </insert><insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>
                     <column name="dict_entry" value="Sud"/>
                     <column name="lastupdated" valueDate=" now() "/>
                     <column name="dictionary_category_id"
                             valueNumeric=" (select id from clinlims.dictionary_category where description = 'haitiDepartment' ) " />
             </insert><insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>
                     <column name="dict_entry" value="Artibonite"/>
                     <column name="lastupdated" valueDate=" now() "/>
                     <column name="dictionary_category_id"
                             valueNumeric=" (select id from clinlims.dictionary_category where description = 'haitiDepartment' ) " />
             </insert><insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>
                     <column name="dict_entry" value="Sud-Est"/>
                     <column name="lastupdated" valueDate=" now() "/>
                     <column name="dictionary_category_id"
                             valueNumeric=" (select id from clinlims.dictionary_category where description = 'haitiDepartment' ) " />
             </insert><insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>
                     <column name="dict_entry" value="Nord'Ouest"/>
                     <column name="lastupdated" valueDate=" now() "/>
                     <column name="dictionary_category_id"
                             valueNumeric=" (select id from clinlims.dictionary_category where description = 'haitiDepartment' ) " />
             </insert><insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>
                     <column name="dict_entry" value="Centre"/>
                     <column name="lastupdated" valueDate=" now() "/>
                     <column name="dictionary_category_id"
                             valueNumeric=" (select id from clinlims.dictionary_category where description = 'haitiDepartment' ) " />
             </insert><insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>
                     <column name="dict_entry" value="Grand'Anse"/>
                     <column name="lastupdated" valueDate=" now() "/>
                     <column name="dictionary_category_id"
                             valueNumeric=" (select id from clinlims.dictionary_category where description = 'haitiDepartment' ) " />
             </insert><insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>
                     <column name="dict_entry" value="Nord'Est"/>
                     <column name="lastupdated" valueDate=" now() "/>
                     <column name="dictionary_category_id"
                             valueNumeric=" (select id from clinlims.dictionary_category where description = 'haitiDepartment' ) " />
             </insert><insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>
                     <column name="dict_entry" value="Nippes"/>
                     <column name="lastupdated" valueDate=" now() "/>
                     <column name="dictionary_category_id"
                             valueNumeric=" (select id from clinlims.dictionary_category where description = 'haitiDepartment' ) " />
             </insert>
  </changeSet>
  <changeSet author="paulsc" id="11" context="haiti,haitiLNSP">
             <preConditions onFail="MARK_RAN">
                     <sqlCheck expectedResult="0">
                         select count(*) from clinlims.patient_identity_type where identity_type = 'GUID';
                     </sqlCheck>
             </preConditions>
             <comment>Adds a patient identiy type of GUID</comment>
             <insert schemaName="clinlims" tableName="patient_identity_type">
                     <column name="id" valueNumeric=" nextval( 'patient_identity_type_seq' ) "/>
                     <column name="identity_type" value="GUID"/>
                     <column name="description" value="A GUID for the patient.  May be generated by a master patient index"/>
                     <column name="lastupdated" valueDate=" now() "/>
             </insert>
  </changeSet>
  <changeSet author="paulsc" id="12" context="haiti,haitiLNSP">
             <comment>Cleans out patients with duplicate GUIDS</comment>
             <sql>
             create view clinlims.import_patient as
                    select min(patient_id), identity_data from clinlims.patient_identity
                    where identity_type_id = (select id from clinlims.patient_identity_type where identity_type = 'GUID')
	                group by identity_data;

                 create view clinlims.patient_matching as select ip.min as rootID, pi.patient_id from clinlims.patient_identity pi
                 join import_patient ip on pi.identity_data = ip.identity_data and NOT ip.min = pi.patient_id;

                 create table clinlims.patient_matching_tb( rootID numeric,	patient_id numeric );

                 insert into patient_matching_tb (rootID, patient_id) select rootId, patient_id from clinlims.patient_matching;

                 update clinlims.sample_human sh set patient_id =
	                    COALESCE((select rootID from clinlims.patient_matching_tb pm where pm.patient_id = sh.patient_id), sh.patient_id);

                 update clinlims.observation_history oh set patient_id =
	                    COALESCE((select rootID from clinlims.patient_matching_tb pm where pm.patient_id = oh.patient_id), oh.patient_id);

                 delete from clinlims.patient_relations where pat_id in (select patient_id from clinlims.patient_matching_tb);
                 delete from clinlims.patient_occupation where patient_id in (select patient_id from clinlims.patient_matching_tb);
                 delete from clinlims.patient_patient_type where patient_id in (select patient_id from clinlims.patient_matching_tb);
                 delete from clinlims.patient_identity where patient_id in (select patient_id from clinlims.patient_matching_tb);

                 create table clinlims.delete_person( person_id numeric );
                 insert into clinlims.delete_person (person_id ) select person_id from clinlims.patient where id in (select patient_id from clinlims.patient_matching_tb);

                 delete from clinlims.patient where id in (select patient_id from clinlims.patient_matching_tb);
                 delete from clinlims.person where id in (select person_id from clinlims.delete_person);

                 drop table clinlims.patient_matching_tb;
                 drop table clinlims.delete_person;

                 drop view clinlims.patient_matching;
                 drop view clinlims.import_patient;
             </sql>
  </changeSet>
  <changeSet author="nixonl" id="4" context="haiti,haitiLNSP">
             <comment>Adds additional sample initial condition reasons to dictionary</comment>
             <loadData file="HaitiCommon/initialConditions_Rev1.csv" schemaName="clinlims" tableName="dictionary">
                       <column name="id" header="id" type="NUMERIC"/>
                       <column name="is_active" header="is_active" type="STRING"/>
                       <column name="dict_entry" header="entry" type="STRING"/>
                       <column name="lastupdated" header="lastupdated" type="DATE"/>
                       <column name="local_abbrev" header="local_abbrev" type="STRING"/>
                       <column name="dictionary_category_id" header="category_id" type="NUMERIC"/>
                       <column name="display_key" header="display_key" type="STRING"/>
             </loadData>
  </changeSet>
  <changeSet author="nixonl" id="5" context="haiti,haitiLNSP">
 		<comment>Fixing sample initial condition reasons display keys</comment>
            <update schemaName="clinlims" tableName="dictionary">
	        	<column name="display_key" value="dictionary.condition.hematolysis"/> 
	        	<where>local_abbrev = 'Hemolysis'</where>
        	</update>
        	<update schemaName="clinlims" tableName="dictionary">
	        	<column name="display_key" value="dictionary.condition.coagulated"/> 
	        	<where>local_abbrev = 'Coag'</where>
        	</update>
        	<update schemaName="clinlims" tableName="dictionary">
	        	<column name="display_key" value="dictionary.condition.insufficient"/> 
	        	<where>local_abbrev = 'Insuff'</where>
        	</update>
        	<update schemaName="clinlims" tableName="dictionary">
	        	<column name="display_key" value="dictionary.condition.contaminated"/> 
	        	<where>local_abbrev = 'Contamin'</where>
        	</update>
        	<update schemaName="clinlims" tableName="dictionary">
	        	<column name="display_key" value="dictionary.condition.inadequate"/> 
	        	<where>local_abbrev = 'Inadequ'</where>
        	</update>
        	<update schemaName="clinlims" tableName="dictionary">
	        	<column name="display_key" value="dictionary.condition.overturned"/> 
	        	<where>local_abbrev = 'Overturned'</where>
        	</update>
        	<update schemaName="clinlims" tableName="dictionary">
	        	<column name="display_key" value="dictionary.condition.other"/> 
	        	<where>local_abbrev = 'Other'</where>
        	</update>
        	<update schemaName="clinlims" tableName="dictionary">
	        	<column name="display_key" value="dictionary.condition.sampleNoForm"/> 
	        	<where>local_abbrev = 'NoForm'</where>
        	</update>
        	<update schemaName="clinlims" tableName="dictionary">
	        	<column name="display_key" value="dictionary.condition.formNoSample"/> 
	        	<where>local_abbrev = 'NoSample'</where>
        	</update>
  </changeSet>
  <changeSet author="nixonl" id="6" context="haiti,haitiLNSP">
 		<comment>Sampletype_test fixes part 1</comment>
 		   
           	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Crachat' ) "/>
	        	<where>test_id=( select id from clinlims.test where description = 'PCR - ADN VIH1 qualitatif' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Salive' ) </where>  	
         	</update>    	
          	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Crachat' ) "/>
	        	<where>test_id=( select id from clinlims.test where description = 'PCR - ARN VIH1 ch. virale' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Salive' ) </where>  	
         	</update>       	
          	 <update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Crachat' ) "/>
	        	<where>test_id=( select id from clinlims.test where description = 'Test de VIH' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Salive' ) </where>  	
         	</update>   	
          	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Crachat' ) "/>
	        	<where>test_id=( select id from clinlims.test where description = 'VIH Test - Oraquick' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Salive' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sample_item">
         		<column name="typeosamp_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Crachat' ) "/>
         		<where>typeosamp_id=( select id from clinlims.type_of_sample where description = 'Salive' )</where>
         	</update>
         	<delete schemaName="clinlims" tableName="sampletype_test">
           		<where>sample_type_id=( select id from clinlims.type_of_sample where description = 'Salive' ) </where>
          	 </delete>
          	 <delete schemaName="clinlims" tableName="sampletype_panel">
           		<where>sample_type_id=( select id from clinlims.type_of_sample where description = 'Salive' ) </where>
          	 </delete>
          	 <delete schemaName="clinlims" tableName="type_of_sample">
           		<where>description='Salive' </where>
          	 </delete>
           	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Acide Urique' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id=( select id from clinlims.test where description = 'Amylase' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id=( select id from clinlims.test where description = 'Azote Urée' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id=( select id from clinlims.test where description = 'Bilirubine direct' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Bilirubine totale' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Ca++' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Créatinine' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Fer Sérique' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Glycémie' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Low Density Lipoprotein' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Phosphat. Alcalines' )  and sample_type_id=  ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>          	
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Triglycérides' )  and sample_type_id=  ( select id from clinlims.type_of_sample where description = 'Sang' )  </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'SGOT AST' )  and sample_type_id=  ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'SGPT ALT' ) and sample_type_id= ( select id from clinlims.type_of_sample where description = 'Sang' )  </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Urée' ) and sample_type_id=  ( select id from clinlims.type_of_sample where description = 'Sang' ) </where>  	
         	</update>
 				
 			<insert schemaName="clinlims" tableName="sampletype_test">
 				<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Acide Urique' ) " /> 
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
	        	<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Amylase' ) " />  	
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Azote Urée' ) " /> 
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Bilirubine direct' ) " /> 	
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Bilirubine totale' ) " /> 
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Ca++' ) " />   	
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Créatinine' ) " />  	
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Fer Sérique' ) " />   
         	</insert>   	
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Glycémie provoquée' ) " /> 
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Low Density Lipoprotein' ) " /> 
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Phosphat. Alcalines' ) " />    	
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Potassium' ) " /> 	
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Protéines Totales' ) " /> 	
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Triglycérides' ) " /> 
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'SGOT AST' ) " /> 
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'SGPT ALT' ) " /> 
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Urée' ) " /> 	
         	</insert>
         	
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Sang' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Malaria - Density Parasitaire' )  and sample_type_id=  ( select id from clinlims.type_of_sample where description = 'Selles' )  </where>  	
         	</update>
         	<update schemaName="clinlims" tableName="sampletype_test">
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Sang' ) "/>
	        	<where>test_id= ( select id from clinlims.test where description = 'Malaria - Forme Parasitaire' )  and sample_type_id=  ( select id from clinlims.type_of_sample where description = 'Selles' )  </where>  	
         	</update> 		
  </changeSet>
  <changeSet author="nixonl" id="7" context="haiti,haitiLNSP">
 		<comment>Sampletype_test fixes part 1</comment>
  		<insert schemaName="clinlims" tableName="test">
                <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
                <column name="description" value="Hépatite B - HBV AcHbe"/> 
                <column name="lastupdated" valueDate='now()' /> 
                <column name="is_active" value='Y' /> 
                <column name="is_reportable" value='N' /> 
                <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Immunology' ) "/> 
                <column name="local_abbrev" value='Hep B - HBV AcHbe' />
                <column name="display_key" value="test.hepBHBVAcHbe"/>
		</insert> 
  		<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Hépatite B - HBV AcHbe' ) " /> 	
         </insert>
         <insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Sang' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Hépatite B - HBV AcHbe' ) " /> 	
         </insert>
         <insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Serum' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Hépatite B - HBV AcHbe' ) " /> 	
         </insert>
         <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Hépatite B - HBV AcHbe' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='Positif' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  </insert>
		  <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Hépatite B - HBV AcHbe' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='Négatif' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  </insert>
		  <update schemaName="clinlims" tableName="test">
           		<column name="description" value="Hépatite B - HBV AcHbC"/>
           		 <column name="local_abbrev" value='Hep B - HBV AcHbC' />
	        	<where>description='Hépatite B - HBV :AcHbC,AcHbe'</where>  	
         </update>	
  </changeSet>
   <changeSet author="nixonl" id="8" context="haiti,haitiLNSP">
 		<comment>Fix for nixonl:7</comment>
 		<delete schemaName="clinlims" tableName="test_result">
          <where>test_id= ( select id from clinlims.test where description = 'Hépatite B - HBV AcHbe' )  </where>
  		</delete>		
 		<insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Hépatite B - HBV AcHbe' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='POSITIF' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  </insert>
		  <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Hépatite B - HBV AcHbe' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='NEG' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  </insert>
	</changeSet>
  <changeSet author="nixonl" id="9" context="haiti, haitiLNSP">
 		<comment>Panel configuration</comment>
 		<insert schemaName="clinlims" tableName="panel">
           		<column name="id" valueNumeric=" nextval( 'panel_seq' ) "/>           	
           		<column name="name" value="Culot Urinaire"/> 
           		<column name="description" value="Culot Urinaire"/> 
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="sampletype_panel">
			<column name="id" valueNumeric=" nextval( 'sample_type_panel_seq' ) "/> 
			<column name="sample_type_id" valueNumeric=" (select id from clinlims.type_of_sample where description='Culot Urinaire' ) "/>
			<column name="panel_id" valueNumeric=" (select id from clinlims.panel where name='Culot Urinaire' ) "/>
		</insert>
		<loadData file="HaitiCommon/PanelItems.csv" schemaName="clinlims" tableName="panel_item">
                <column name="id" header="id" type="NUMERIC"/>
                <column name="panel_id" header="panel_id" type="NUMERIC"/>
                <column name="lastupdated" header="lastupdated" type="DATE"/>
                <column name="test_local_abbrev" header="test_local_abbrev" type="STRING"/>
        </loadData>	
 	</changeSet> 
  <changeSet author="paulsc" id="13" context="haiti,haitiLNSP">
        <comment>Adds department, commune and village to address parts</comment>
        <insert schemaName="clinlims" tableName="address_part">
                <column name="id" valueNumeric=" nextval( 'address_part_seq' )  "/>
                <column name="part_name" value="department"/>
                <column name="display_key" value="address.department"/>
        </insert>
        <insert schemaName="clinlims" tableName="address_part">
                <column name="id" valueNumeric=" nextval( 'address_part_seq' )  "/>
                <column name="part_name" value="commune"/>
                <column name="display_key" value="address.commune"/>
        </insert>
        <insert schemaName="clinlims" tableName="address_part">
                <column name="id" valueNumeric=" nextval( 'address_part_seq' )  "/>
                <column name="part_name" value="village"/>
                <column name="display_key" value="address.village"/>
        </insert>
  </changeSet> 
  <changeSet author="nixonl" id="14" context="haiti,haitiLNSP">
        <comment>Fix typo in test name</comment>     
         <delete schemaName="clinlims" tableName="test_result">
          	<where>test_id = (select id from clinlims.test where description='Protéines (Urine)' )</where>
        </delete>
         <delete schemaName="clinlims" tableName="test_analyte">
          	<where>test_id = (select id from clinlims.test where description='Protéines (Urine)' )</where>
        </delete>
        <delete schemaName="clinlims" tableName="test">
          	<where>description='Protéines (Urine)'</where>
        </delete>    

        <update schemaName="clinlims" tableName="test">
       		<column name="description" value="Protéines (Urine)"/> 		 
     		<where>description='Proteines (Urine)'</where>  	
    	</update>
    	<sql>
            delete from clinlims.sampletype_test where id in ( select min(id) from clinlims.sampletype_test where test_id= ( select id from clinlims.test where local_abbrev = 'Cristaux - UAm' )  and sample_type_id =  ( select id from clinlims.type_of_sample where description = 'Culot Urinaire' ) )
        </sql>
  </changeSet>

  <changeSet author="nixonl" id="15" context="haiti,haitiLNSP">
        <comment>Adding more tests</comment>     
        <loadData file="HaitiCommon/HaitiCommonTests1.csv" schemaName="clinlims" tableName="test">
            <column name="id" header="id" type="NUMERIC"/>
            <column name="test_section_id" header="test_section" type="NUMERIC"/>
			<column name="description" header="name"  type="STRING" />
			<column name="local_abbrev" header="local_abbrev"  type="STRING" />
			<column name="lastupdated" header="lastupdated" type="DATE"/>
			<column name="is_active" header="active" type="STRING"/>
			<column name="is_reportable" header="reportable" type="STRING"/>
       	</loadData>
       	<loadData file="HaitiCommon/HaitiCommonSampleTypeTests1.csv" schemaName="clinlims" tableName="sampletype_test">
            <column name="id" header="id" type="NUMERIC"/>
            <column name="sample_type_id" header="sampletype" type="NUMERIC"/>
            <column name="test_id" header="test" type="NUMERIC"/>	
       	</loadData>
       	<loadData file="HaitiCommon/HaitiCommonTestResults1.csv" schemaName="clinlims" tableName="test_result">
            <column name="id" header="id" type="NUMERIC"/>
          	 <column name="tst_rslt_type" header="result_type" type="STRING"/>
            <column name="test_id" header="test" type="NUMERIC"/>	
            <column name="lastupdated" header="lastupdated" type="DATE"/>
       	</loadData>
  </changeSet>
  <changeSet author="nixonl" id="16" context="haiti,haitiLNSP">
        <comment>Adding Secretions genito-urinaire sampletype</comment>  
  		<insert schemaName="clinlims" tableName="type_of_sample">
                <column name="id" valueNumeric=" nextval( 'type_of_sample_seq' ) "/>
                <column name="description" value="Secretions genito-urinaire"/> 
                <column name="lastupdated" valueDate='now()' /> 
                <column name="domain" value='H' />  
                <column name="local_abbrev" value='SECR GENUR' />
                <column name="display_key" value="sample.type.genitourine"/>
		</insert> 
  		<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Secretions genito-urinaire' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Coloration de Gram' ) " /> 	
        </insert>   
  </changeSet>
  <changeSet author="nixonl" id="17" context="haiti,haitiLNSP">
        <comment>Adding panel for Cristaux urine tests</comment>  
  		<insert schemaName="clinlims" tableName="panel">
           		<column name="id" valueNumeric=" nextval( 'panel_seq' ) "/>           	
           		<column name="name" value="Cristaux"/> 
           		<column name="description" value="Cristaux"/> 
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="sampletype_panel">
			<column name="id" valueNumeric=" nextval( 'sample_type_panel_seq' ) "/> 
			<column name="sample_type_id" valueNumeric=" (select id from clinlims.type_of_sample where description='Urine' ) "/>
			<column name="panel_id" valueNumeric=" (select id from clinlims.panel where name='Cristaux' ) "/>
		</insert>
		<insert schemaName="clinlims" tableName="sampletype_panel">
			<column name="id" valueNumeric=" nextval( 'sample_type_panel_seq' ) "/> 
			<column name="sample_type_id" valueNumeric=" (select id from clinlims.type_of_sample where description='Culot Urinaire' ) "/>
			<column name="panel_id" valueNumeric=" (select id from clinlims.panel where name='Cristaux' ) "/>
		</insert>
		<loadData file="HaitiCommon/PanelItems1.csv" schemaName="clinlims" tableName="panel_item">
                <column name="id" header="id" type="NUMERIC"/>
                <column name="panel_id" header="panel_id" type="NUMERIC"/>
                <column name="lastupdated" header="lastupdated" type="DATE"/>
                <column name="test_local_abbrev" header="test_local_abbrev" type="STRING"/>
        </loadData>	  
  </changeSet>
  <changeSet author="nixonl" id="18" context="haiti,haitiLNSP">
  	<comment>Adding new department, Mycobacteriology</comment>
  	<insert schemaName="clinlims" tableName="test_section">
                <column name="id" valueNumeric=" nextval( 'test_section_seq' ) "/>
                 <column name="org_id" valueNumeric=" ( select id from clinlims.organization where name='Haiti' ) "/>
                <column name="name" value="Mycobacteriology"/> 
                <column name="description" value="Mycobacteriology"/>
                <column name="lastupdated" valueDate='now()' /> 
                <column name="is_external" value='N' />   
                <column name="display_key" value="test.section.mycobacteriology"/>
	</insert>
  </changeSet>
  <changeSet author="paulsc" id="14" context="haiti,haitiLNSP">
       <comment>Sets modules to roles</comment>
       <insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'LogbookResults:mycobacteriology' ) "/>
       </insert>
</changeSet>
<changeSet author="paulsc" id="15" context="haiti,haitiLNSP">
           <comment>Moving person address parts from patient_identity to person_address</comment>
           <sql>
           INSERT INTO clinlims.person_address(person_id, address_part_id, "type", "value")
                  select p.person_id,  ap.id, 'T', pi.identity_data from clinlims.patient_identity pi
                  join clinlims.address_part ap on ap.part_name = 'commune'
                  join clinlims.patient p on p.id = pi.patient_id
                  where  identity_type_id = ( select id from clinlims.patient_identity_type where identity_type = 'COMMUNE' );
           INSERT INTO clinlims.person_address(person_id, address_part_id, "type", "value")
                  select p.id,  ap.id, 'T', p.city from clinlims.person p
                  join clinlims.address_part ap on ap.part_name = 'village'
                  where char_length(p.city) &gt; 1 AND NOT p.city IS NULL;
           INSERT INTO clinlims.person_address(person_id, address_part_id, "type", "value")
                  select p.person_id,  ap.id, 'T', pi.identity_data from clinlims.patient_identity pi
                  join clinlims.address_part ap on ap.part_name = 'department'
                  join clinlims.patient p on p.id = pi.patient_id
                  where  identity_type_id = ( select id from clinlims.patient_identity_type where identity_type = 'ADDRESS_DEPT' );
           DELETE FROM clinlims.patient_identity where identity_type_id IN ( select id from clinlims.patient_identity_type where identity_type in ('COMMUNE','ADDRESS_DEPT'));
           DELETE FROM clinlims.patient_identity_type where identity_type in ('COMMUNE','ADDRESS_DEPT');
           Update clinlims.person SET city = NULL where char_length(city) &gt; 1 AND NOT city IS NULL;
           </sql>
</changeSet>
<changeSet author="paulsc" id="16" context="haiti,haitiLNSP">
           <comment>Removes leading space from short_name of organization</comment>
           <sql>
                update clinlims.organization set short_name = trim(both from short_name);
           </sql>
</changeSet>
<changeSet author="nixonl" id="19" context="haiti,haitiLNSP">
  	<comment>Sampletype and panel fixes</comment>
    <delete schemaName="clinlims" tableName="sampletype_test">
    	<where>id =  ( select min(id) from clinlims.sampletype_test where test_id= ( select id from clinlims.test where local_abbrev = 'Glycémie' )  and sample_type_id =  ( select id from clinlims.type_of_sample where description = 'Serum' ) ) </where>
    </delete>
    <insert schemaName="clinlims" tableName="panel_item">
              <column name="id"  valueNumeric=" nextval( 'panel_item_seq' ) "/>
              <column name="panel_id"  valueNumeric=" ( select id from clinlims.panel where name='Culot Urinaire' ) "/>
              <column name="lastupdated" valueDate='now()' /> 
              <column name="test_local_abbrev" value="GramStain"/>
     </insert>	     
 </changeSet>
<changeSet author="nixonl" id="20" context="haiti,haitiLNSP">
       <comment>Adding more tests</comment>     
       <insert schemaName="clinlims" tableName="type_of_sample">
               <column name="id" valueNumeric=" nextval( 'type_of_sample_seq' ) "/>
               <column name="description" value="Aspiration nasopharyngée"/> 
               <column name="lastupdated" valueDate='now()' /> 
               <column name="domain" value='H' />  
               <column name="local_abbrev" value='NASO ASP' />
               <column name="display_key" value="sample.type.nasopharyngealAspiration"/>
	</insert> 
	<insert schemaName="clinlims" tableName="type_of_sample">
               <column name="id" valueNumeric=" nextval( 'type_of_sample_seq' ) "/>
               <column name="description" value="Ecouvillonage nasal"/> 
               <column name="lastupdated" valueDate='now()' /> 
               <column name="domain" value='H' />  
               <column name="local_abbrev" value='NASLSWAB' />
               <column name="display_key" value="sample.type.nasalSwab"/>
	</insert> 
	<insert schemaName="clinlims" tableName="type_of_sample">
               <column name="id" valueNumeric=" nextval( 'type_of_sample_seq' ) "/>
               <column name="description" value="Ecouvillonage nosapharyngé"/> 
               <column name="lastupdated" valueDate='now()' /> 
               <column name="domain" value='H' />  
               <column name="local_abbrev" value='SWABNASO' />
               <column name="display_key" value="sample.type.nasoSwab"/>
	</insert> 
	<insert schemaName="clinlims" tableName="type_of_sample">
               <column name="id" valueNumeric=" nextval( 'type_of_sample_seq' ) "/>
               <column name="description" value="Sécrétion de la gorge"/> 
               <column name="lastupdated" valueDate='now()' /> 
               <column name="domain" value='H' />  
               <column name="local_abbrev" value='THROATSECR' />
               <column name="display_key" value="sample.type.throatSecretion"/>
	</insert>
	<insert schemaName="clinlims" tableName="type_of_sample">
               <column name="id" valueNumeric=" nextval( 'type_of_sample_seq' ) "/>
               <column name="description" value="DBS"/> 
               <column name="lastupdated" valueDate='now()' /> 
               <column name="domain" value='H' />  
               <column name="local_abbrev" value='DBS' />
               <column name="display_key" value="sample.type.DBS"/>
	</insert>
	<insert schemaName="clinlims" tableName="type_of_sample">
               <column name="id" valueNumeric=" nextval( 'type_of_sample_seq' ) "/>
               <column name="description" value="Prélèvement rhinopharyngé"/> 
               <column name="lastupdated" valueDate='now()' /> 
               <column name="domain" value='H' />  
               <column name="local_abbrev" value='Nasopharyn' />
               <column name="display_key" value="sample.type.nasopharynSwab"/>
	</insert>
	<update schemaName="clinlims" tableName="test">
          		<column name="description" value="Recherche de BAAR (Crachat)"/>
        	<where>description='recherche de BAAR' </where>  	
       </update>  
       <loadData file="HaitiCommon/HaitiCommonDictTestResults2.csv" schemaName="clinlims" tableName="dictionary">
           	<column name="id" header="id" type="NUMERIC"/>
           	<column name="is_active" header="active" type="STRING"/>
			<column name="dict_entry" header="dict_entry"  type="STRING" />
			<column name="lastupdated" header="lastupdated" type="DATE"/>
			<column name="dictionary_category_id" header="category" type="NUMERIC"/>
			<column name="display_key" header="display_key" type="STRING"/>
      	</loadData>
       <loadData file="HaitiCommon/HaitiCommonTests2.csv" schemaName="clinlims" tableName="test">
           <column name="id" header="id" type="NUMERIC"/>
           <column name="test_section_id" header="test_section" type="NUMERIC"/>
		<column name="description" header="description"  type="STRING" />
		<column name="local_abbrev" header="local_abbrev"  type="STRING" />
		<column name="lastupdated" header="lastupdated" type="DATE"/>
		<column name="is_active" header="active" type="STRING"/>
		<column name="is_reportable" header="reportable" type="STRING"/>
		<column name="display_key" header="display_key" type="STRING"/>
      	</loadData>
      	<loadData file="HaitiCommon/HaitiCommonSampleTypeTests2.csv" schemaName="clinlims" tableName="sampletype_test">
           <column name="id" header="id" type="NUMERIC"/>
           <column name="sample_type_id" header="sampletype" type="NUMERIC"/>
           <column name="test_id" header="test" type="NUMERIC"/>	
      	</loadData>
      	<loadData file="HaitiCommon/HaitiCommonTestResults2a.csv" schemaName="clinlims" tableName="test_result">
           <column name="id" header="id" type="NUMERIC"/>
         	<column name="tst_rslt_type" header="result_type" type="STRING"/>
         	<column name="value" header="value" type="STRING"/>
           <column name="test_id" header="test" type="NUMERIC"/>	
           <column name="lastupdated" header="lastupdated" type="DATE"/>
       </loadData>
       <loadData file="HaitiCommon/HaitiCommonTestResults2b.csv" schemaName="clinlims" tableName="test_result">
           <column name="id" header="id" type="NUMERIC"/>
         	<column name="tst_rslt_type" header="result_type" type="STRING"/>
         	<column name="value" header="value" type="NUMERIC"/>
           <column name="test_id" header="test" type="NUMERIC"/>	
           <column name="lastupdated" header="lastupdated" type="DATE"/>
       </loadData>
 </changeSet>
 <changeSet author="nixonl" id="21" context="haitiLNSP">
           <comment>Add mycobacteriology tests for LNSP</comment>
			<update schemaName="clinlims" tableName="test">
	           		<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Mycobacteriology' ) "/>
		        	<where>description='Recherche de BAAR (Crachat)' </where>  	
			</update>
			<update schemaName="clinlims" tableName="test">
	           		<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Mycobacteriology' ) "/>
		        	<where>description='Recherche de BAAR (LCR)' </where>  	
			</update> 
			<update schemaName="clinlims" tableName="test">
	           		<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Mycobacteriology' ) "/>
		        	<where>description='Recherche de BAAR (Liquide Ascite)' </where>  	
			</update> 
			<update schemaName="clinlims" tableName="test">
	           		<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Mycobacteriology' ) "/>
		        	<where>description='Recherche de BAAR (Liquide Pleural)' </where>  	
			</update> 
			<update schemaName="clinlims" tableName="test">
	           		<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Mycobacteriology' ) "/>
		        	<where>description='Recherche de BAAR (Liquide Synovial)' </where>  	
			</update>  
			<update schemaName="clinlims" tableName="test">
	           		<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Mycobacteriology' ) "/>
		        	<where>description='Culture pour TB (Crachat)' </where>  	
			</update>
			<update schemaName="clinlims" tableName="test">
	           		<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Mycobacteriology' ) "/>
		        	<where>description='Culture pour TB (LCR)' </where>  	
			</update> 
			<update schemaName="clinlims" tableName="test">
	           		<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Mycobacteriology' ) "/>
		        	<where>description='Culture pour TB (Liquide Ascite)' </where>  	
			</update> 
			<update schemaName="clinlims" tableName="test">
	           		<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Mycobacteriology' ) "/>
		        	<where>description='Culture pour TB (Liquide Pleural)' </where>  	
			</update> 
			<update schemaName="clinlims" tableName="test">
	           		<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Mycobacteriology' ) "/>
		        	<where>description='Culture pour TB (Liquide Synovial)' </where>  	
			</update>  	
</changeSet>
<changeSet author="nixonl" id="22" context="haiti,haitiLNSP">
	 <comment>Adding panel named 'Test de grossesse' </comment>
	 <insert schemaName="clinlims" tableName="panel">
           		<column name="id" valueNumeric=" nextval( 'panel_seq' ) "/>           	
           		<column name="name" value="Test de grossesse"/> 
           		<column name="description" value="Test de grossesse"/> 
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="sampletype_panel">
			<column name="id" valueNumeric=" nextval( 'sample_type_panel_seq' ) "/> 
			<column name="sample_type_id" valueNumeric=" (select id from clinlims.type_of_sample where description='Serum/Urine Concentre du Matin' ) "/>
			<column name="panel_id" valueNumeric=" (select id from clinlims.panel where name='Test de grossesse' ) "/>
		</insert>
		<insert schemaName="clinlims" tableName="panel_item">
              <column name="id"  valueNumeric=" nextval( 'panel_item_seq' ) "/>
              <column name="panel_id"  valueNumeric=" ( select id from clinlims.panel where name='Test de grossesse' ) "/>
              <column name="lastupdated" valueDate='now()' /> 
              <column name="test_local_abbrev" value="βHCG Quant"/>
	    </insert>
	    <insert schemaName="clinlims" tableName="panel_item">
              <column name="id"  valueNumeric=" nextval( 'panel_item_seq' ) "/>
              <column name="panel_id"  valueNumeric=" ( select id from clinlims.panel where name='Test de grossesse' ) "/>
              <column name="lastupdated" valueDate='now()' /> 
              <column name="test_local_abbrev" value="βHCG Qual"/>
	    </insert>
	    
</changeSet>
<changeSet author="nixonl" id="23" context="haiti,haitiLNSP">
	 <comment>Remove malaria panel </comment>
	  <delete schemaName="clinlims" tableName="panel_item">
	 	 <where>panel_id=( select id from clinlims.panel where name='Malaria' )</where>
	  </delete>
	  <delete schemaName="clinlims" tableName="sampletype_panel">
	 	 <where>panel_id=( select id from clinlims.panel where name='Malaria' )</where>
	  </delete>
	  <delete schemaName="clinlims" tableName="panel">
	 	 <where>id=( select id from clinlims.panel where name='Malaria' )</where>
	  </delete> 
</changeSet>
<changeSet author="nixonl" id="24" context="haiti,haitiLNSP">
	<comment>Moving tests to different sampletypes by deactivating</comment>
		 <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Microsporum Species (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveMicroSpecies"/>
          		 <where>id=( select id from clinlims.test where description = 'Microsporum Species' ) </where> 
         </update>
         <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="T.schoenleinii (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveTschoen"/>
          		 <where>id=( select id from clinlims.test where description = 'T.schoenleinii' ) </where> 
         </update>
         <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="T.soudanense (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveTsoud"/>
          		 <where>id=( select id from clinlims.test where description = 'T.soudanense' ) </where> 
         </update>
         <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="T.tonsurans (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveT.tonsur"/>
          		 <where>id=( select id from clinlims.test where description = 'T.tonsurans' ) </where> 
         </update>
         <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Trichophyton Species (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveTrichSpecies"/>
          		 <where>id=( select id from clinlims.test where description = 'Trichophyton Species' ) </where> 
         </update>
        <update schemaName="clinlims" tableName="sample_item">
         		<column name="typeosamp_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Pus' ) "/>
         		<where>typeosamp_id=( select id from clinlims.type_of_sample where description = 'Pus/Culture' )</where>
       	</update>
       	<delete schemaName="clinlims" tableName="sampletype_test">
        		<where>sample_type_id=( select id from clinlims.type_of_sample where description = 'Pus/Culture' ) </where>
       	 </delete>
       	 <delete schemaName="clinlims" tableName="sampletype_panel">
        		<where>sample_type_id=( select id from clinlims.type_of_sample where description = 'Pus/Culture' ) </where>
       	 </delete>
       	 <delete schemaName="clinlims" tableName="type_of_sample">
        		<where>description='Pus/Culture' </where>
       	 </delete>
       	 <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Chlore (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveChlore"/>
          		 <where>id=( select id from clinlims.test where description = 'Chlore' ) </where> 
         </update>
         <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Vitesse de Sédimentation (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveVitesse"/>
          		 <where>id=( select id from clinlims.test where description = 'Vitesse de Sédimentation' ) </where> 
         </update>
         <update schemaName="clinlims" tableName="test">
         		 <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Bacteria' ) "/>
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Mantoux / PPD (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveMantouxPPD"/>
          		 <where>id=( select id from clinlims.test where description = 'Mantoux / PPD' ) </where> 
         </update>
       	 <loadData file="HaitiCommon/HaitiCommonTests3.csv" schemaName="clinlims" tableName="test">
	          	<column name="id" header="id" type="NUMERIC"/>
	          	<column name="test_section_id" header="test_section" type="NUMERIC"/>
				<column name="description" header="description"  type="STRING" />
				<column name="local_abbrev" header="local_abbrev"  type="STRING" />
				<column name="lastupdated" header="lastupdated" type="DATE"/>
				<column name="is_active" header="active" type="STRING"/>
				<column name="is_reportable" header="reportable" type="STRING"/>
				<column name="display_key" header="display_key" type="STRING"/>
      	</loadData>
      	<loadData file="HaitiCommon/HaitiCommonSampleTypeTests3.csv" schemaName="clinlims" tableName="sampletype_test">
	           <column name="id" header="id" type="NUMERIC"/>
	           <column name="sample_type_id" header="sampletype" type="NUMERIC"/>
	           <column name="test_id" header="test_id" type="NUMERIC"/>	
      	</loadData>
      	<loadData file="HaitiCommon/HaitiCommonTestResults3.csv" schemaName="clinlims" tableName="test_result">
          		<column name="id" header="id" type="NUMERIC"/>
         		<column name="tst_rslt_type" header="result_type" type="STRING"/>
         		<column name="value" header="value" type="NUMERIC"/>
           		<column name="test_id" header="test" type="NUMERIC"/>	
           		<column name="lastupdated" header="lastupdated" type="DATE"/>
       </loadData>
</changeSet>
<changeSet author="nixonl" id="25" context="haiti,haitiLNSP">
            <comment>Making malaria test multiple select</comment>
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NEG' ) and test_id = ( select id from clinlims.test where description = 'Malaria - Density Parasitaire' ) ) " />
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NEG' ) and test_id = ( select id from clinlims.test where description = 'Malaria - Forme Parasitaire' ) ) </where>     
            </update>
            <update schemaName="clinlims" tableName="test_result">
                       <column name="tst_rslt_type" value="M"/>
                    <where>test_id=( select id from clinlims.test where description = 'Malaria - Density Parasitaire' ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NEG' ) and test_id = ( select id from clinlims.test where description = 'Malaria - Forme Parasitaire' ) );           
            </sql>            
             <update schemaName="clinlims" tableName="test_result">
                       <column name="tst_rslt_type" value="M"/>
                       <column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Malaria - Density Parasitaire' ) "/>
                    <where>test_id=( select id from clinlims.test where description = 'Malaria - Forme Parasitaire' ) </where>                
            </update>    
            <update schemaName="clinlims" tableName="test_result"> 
                       <column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Malaria - Density Parasitaire' ) "/>
                    <where>test_id=( select id from clinlims.test where description = 'Malaria - Forme Parasitaire' ) </where>                
            </update>
            <update schemaName="clinlims" tableName="test_result">
                       <column name="tst_rslt_type" value="M"/>
                    <where>test_id=( select id from clinlims.test where description = 'Malaria - Density Parasitaire' ) </where>     
            </update>
            <sql>
            	update clinlims.result set result_type='M' where test_result_id IN ( select id from clinlims.test_result where test_id = ( select id from clinlims.test where description = 'Malaria - Density Parasitaire' ) );
            </sql>      
            <sql>
                update clinlims.analysis set test_id = ( select id from clinlims.test where description = 'Malaria - Density Parasitaire' ) where test_id = ( select id from clinlims.test where description = 'Malaria - Forme Parasitaire' );           
            </sql>  
            <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Malaria (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveMalaria"/>
          		 <where>id=( select id from clinlims.test where description = 'Malaria' ) </where> 
            </update> 
            <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Malaria - Forme Parasitaire(Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveMalariaForme"/>
          		 <where>id=( select id from clinlims.test where description = 'Malaria - Forme Parasitaire' ) </where> 
            </update>  
            <update schemaName="clinlims" tableName="test">
          		 <column name="description" value="Malaria"/>
          		 <column name="local_abbrev" value="Malaria"/>
          		 <where>id=( select id from clinlims.test where description = 'Malaria - Density Parasitaire' ) </where> 
            </update>
</changeSet>
<changeSet author="nixonl" id="26" context="haiti,haitiLNSP">
            <comment>Remove extra test result for EID PCR</comment>
            <delete schemaName="clinlims" tableName="test_result">
             	<where>test_id=( select id from clinlims.test where description = 'EID PCR (DBS)' ) and value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'IND' ) </where> 
            </delete>   
</changeSet>
<changeSet author="nixonl" id="27" context="haiti,haitiLNSP">
            <comment>Test configuration Part 3</comment>
            <update schemaName="clinlims" tableName="test">
          		 <column name="description" value="Aspect"/>
          		 <column name="local_abbrev" value="Aspect"/>
          		 <where>id=( select id from clinlims.test where description = 'Cyto - Aspect' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="test">
          		 <column name="description" value="Leucocytes"/>
          		 <column name="local_abbrev" value="Leucocytes"/>
          		 <where>id=( select id from clinlims.test where description = 'Cyto - Leucocytes' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="test">
          		 <column name="description" value="Levures"/>
          		 <column name="local_abbrev" value="Levures"/>
          		 <where>id=( select id from clinlims.test where description = 'Cyto - Levures' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="test">
          		 <column name="description" value="pH"/>
          		 <column name="local_abbrev" value="pH"/>
          		 <where>id=( select id from clinlims.test where description = 'Cyto - pH' ) </where> 
            </update>
           	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'DBS' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'VIH Test - Collodial Gold/Shangai Kehua' ) " /> 	
        	</insert>
        	<insert schemaName="clinlims" tableName="sampletype_test">
         		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'DBS' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'VIH Test - Determine' ) " /> 	
        	</insert>
        	<update schemaName="clinlims" tableName="sampletype_test">
        		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Sang' ) "/>
        		<where>test_id  = ( select t.id from clinlims.test t where t.description = 'Numération des Globules Rouges (Sang)' )</where> 	
        	</update>  	
            <sql>
             	delete from clinlims.sampletype_test where id in ( select min(id) from clinlims.sampletype_test where test_id= ( select id from clinlims.test where local_abbrev = 'Levures' )  and sample_type_id =  ( select id from clinlims.type_of_sample where description = 'Liquide Pleural' ) )
            </sql>	     
</changeSet>
<changeSet author="nixonl" id="28" context="haiti,haitiLNSP">
            <comment>Test configuration Part 4</comment>      
        	<update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Diphtérie (Secretion Urethrale) (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveDiphUreth"/>
          		 <where>id=( select id from clinlims.test where description = 'Diphtérie (Secretion Urethrale)' ) </where> 
          	</update>
          	<update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Diphtérie (Secretion Vaginale) (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveDiphVag"/>
          		 <where>id=( select id from clinlims.test where description = 'Diphtérie (Secretion Vaginale)' ) </where> 
          	</update>
            <update schemaName="clinlims" tableName="result">
            	 <column name="value" valueNumeric=" ( select id from clinlims.dictionary where dict_entry = 'Positif (+)' ) "/>
            	 <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where test_id = ( select id from clinlims.test where description = 'Malaria' ) and value = ( select cast (id as text) from clinlims.dictionary where dict_entry = 'Positif (+)' ) ) " />
            	 <where>value = ( select cast (id as text) from clinlims.dictionary where dict_entry = '1+' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="result">
            	 <column name="value" valueNumeric=" ( select id from clinlims.dictionary where dict_entry = 'Positif (++)' ) "/>
            	 <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where test_id = ( select id from clinlims.test where description = 'Malaria' ) and value = ( select cast (id as text) from clinlims.dictionary where dict_entry = 'Positif (++)' ) ) " />
            	 <where>value = ( select cast (id as text) from clinlims.dictionary where dict_entry = '2+' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="result">
            	 <column name="value" valueNumeric=" ( select cast (id as text) from clinlims.dictionary where dict_entry= 'Positif (+++)' ) "/>
            	 <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where test_id = ( select id from clinlims.test where description = 'Malaria' ) and value = ( select cast (id as text) from clinlims.dictionary where dict_entry = 'Positif (+++)' ) ) " />
            	 <where>value = ( select cast (id as text) from clinlims.dictionary where dict_entry = '3+' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="result">
            	 <column name="value" valueNumeric=" ( select cast (id as text) from clinlims.dictionary where dict_entry = 'Positif (+++)' ) "/>
            	 <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where test_id = ( select id from clinlims.test where description = 'Malaria' ) and value = ( select cast (id as text) from clinlims.dictionary where dict_entry = 'Positif (+++)' ) ) " />
            	 <where>value = ( select cast (id as text) from clinlims.dictionary where dict_entry = '4+' ) </where> 
            </update>
            <delete schemaName="clinlims" tableName="test_result">
            	<where>test_id=( select id from clinlims.test where description = 'Malaria' ) and value = ( select cast (id as text) from clinlims.dictionary where dict_entry = '1+' ) </where> 
            </delete>
            <delete schemaName="clinlims" tableName="test_result">
            	<where>test_id=( select id from clinlims.test where description = 'Malaria' ) and value = ( select cast (id as text) from clinlims.dictionary where dict_entry = '2+' ) </where> 
            </delete>
            <delete schemaName="clinlims" tableName="test_result">
            	<where>test_id=( select id from clinlims.test where description = 'Malaria' )and value = ( select cast (id as text) from clinlims.dictionary where dict_entry = '3+' ) </where> 
            </delete>
            <delete schemaName="clinlims" tableName="test_result">
            	<where>test_id=( select id from clinlims.test where description = 'Malaria' ) and value = ( select cast (id as text) from clinlims.dictionary where dict_entry = '4+' ) </where> 
            </delete>
            <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Acétone (Urine)' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='NEG' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert>
		  	<insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>
                     <column name="dict_entry" value="Rare"/>
                     <column name="lastupdated" valueDate=" now() "/> 
             </insert>
		  	<insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Cell Epithéliales (Urine)' ) "/>
           		<column name="tst_rslt_type" value="M"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where dict_entry='Rare' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert>
		  	<insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Levures (Urine)' ) "/>
           		<column name="tst_rslt_type" value="M"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where dict_entry='Rare' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert>
		  	<insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Levures (Urine)' ) "/>
           		<column name="tst_rslt_type" value="M"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='NEG'  ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert>
            
</changeSet>
<changeSet author="nixonl" id="29" context="haiti,haitiLNSP">
            <comment>Test configuration Part 5</comment>         
            <loadData file="HaitiCommon/dictionaryTestResults1.csv" schemaName="clinlims" tableName="dictionary">
                       <column name="id" header="id" type="NUMERIC"/>
                       <column name="is_active" header="is_active" type="STRING"/>
                       <column name="dict_entry" header="entry" type="STRING"/>
                       <column name="lastupdated" header="lastupdated" type="DATE"/>
                       <column name="local_abbrev" header="local_abbrev" type="STRING"/> 
                       <column name="display_key" header="display_key" type="STRING"/>
            </loadData>
            <insert schemaName="clinlims" tableName="test">
	          	<column name="id" valueNumeric=" nextval( 'test_seq' ) "/>  
	          	<column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where description = 'Bacteria' ) "/>
				<column name="description" value="Cristaux (Culot Urinaire)" />
				<column name="local_abbrev"  value="CristxCulotUrin" />
				<column name="lastupdated" valueDate='now()' /> 
				<column name="is_active" value="Y" />
				<column name="is_reportable" value="N"/>
				<column name="display_key" value="test.cristaux.cultoturinaire"/>
	      	</insert>
	      	<update schemaName="clinlims" tableName="test">
	      		<column name="is_active" value="Y" />
	      		<where>description = 'Cristaux (Urine)'</where>   		
	      	</update>
	      	<insert schemaName="clinlims" tableName="sampletype_test">
 				<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Urine' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Cristaux (Urine)' ) " /> 
         	</insert>
         	<insert schemaName="clinlims" tableName="sampletype_test">
 				<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
           		<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Culot Urinaire' ) "/>
           		<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Cristaux (Culot Urinaire)' ) " /> 
         	</insert>
         	<delete schemaName="clinlims" tableName="panel_item">
         		<where>panel_id = ( select id from clinlims.panel where name = 'Cristaux' ) </where>
         	</delete>
         	<delete schemaName="clinlims" tableName="sampletype_panel">
         		<where>panel_id = ( select id from clinlims.panel where name = 'Cristaux' )</where>
         	</delete>
         	<delete schemaName="clinlims" tableName="panel">
         		<where>name = 'Cristaux'</where>
         	</delete>
            <loadData file="HaitiCommon/HaitiCommonTestResults3a.csv" schemaName="clinlims" tableName="test_result">
          		<column name="id" header="id" type="NUMERIC"/>
         		<column name="tst_rslt_type" header="result_type" type="STRING"/>
         		<column name="value" header="value" type="NUMERIC"/>
           		<column name="test_id" header="test" type="NUMERIC"/>	
           		<column name="lastupdated" header="lastupdated" type="DATE"/>
       		</loadData>      
       		<update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Cristaux - Oxalate de Ca (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveMalaria"/>
          		 <where>id=( select id from clinlims.test where description = 'Cristaux - Oxalate de Ca' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Cristaux - Phosphate Amorphes (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveCrisPhosAm"/>
          		 <where>id=( select id from clinlims.test where description = 'Cristaux - Phosphate Amorphes' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Cristaux - Phosphate Triples (Invalid)"/>
          		 <column name="local_abbrev" value="DeactivePhosTrip"/>
          		 <where>id=( select id from clinlims.test where description = 'Cristaux - Phosphate Triples' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Cristaux - Phosphate de Ca (Invalid)"/>
          		 <column name="local_abbrev" value="DeactivePhosCa"/>
          		 <where>id=( select id from clinlims.test where description = 'Cristaux - Phosphate de Ca' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Cristaux - Phosphate de Mg (Invalid)"/>
          		 <column name="local_abbrev" value="DeactivePhosMg"/>
          		 <where>id=( select id from clinlims.test where description = 'Cristaux - Phosphate de Mg' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Cristaux - Sulfate de Ca (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveSulCa"/>
          		 <where>id=( select id from clinlims.test where description = 'Cristaux - Sulfate de Ca' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Cristaux - Urates Amorphes (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveUrAm"/>
          		 <where>id=( select id from clinlims.test where description = 'Cristaux - Urates Amorphes' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Cristaux - Urates d&apos;'Ammonium (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveUrAmm"/>
          		 <where>id=( select id from clinlims.test where description = 'Cristaux - Urates d&apos;'Ammonium' ) </where> 
            </update>
            <update schemaName="clinlims" tableName="test">
          		 <column name="is_active" value="N"/>
          		 <column name="description" value="Cristaux - Acid Urique (Invalid)"/>
          		 <column name="local_abbrev" value="DeactiveAcidUr"/>
          		 <where>id=( select id from clinlims.test where description = 'Cristaux - acid urique' ) </where> 
          	</update>		   
</changeSet>
<changeSet author="nixonl" id="30" context="haiti,haitiLNSP">
            <comment>Fixing test without test section</comment>   
			<update schemaName="clinlims" tableName="test">
          		 <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Bacteria' ) "/> 
          		 <where>description = 'Cristaux (Culot Urinaire)'</where> 
          	</update>
</changeSet>
<changeSet author="nixonl" id="31" context="haiti,haitiLNSP">
            <comment>Test Configuration part 5 - fix</comment>    
            <sql>delete from clinlims.result where analysis_id in ( select id from clinlims.analysis where test_id in ( select id from clinlims.test where description= 'Cristaux (Culot Urinaire)' ) ) ;</sql>
            <sql>delete from clinlims.result where analysis_id in ( select id from clinlims.analysis where test_id in ( select id from clinlims.test where description= 'Cristaux (Urine)' ) ) ;</sql>
            <sql>delete from clinlims.analysis where test_id = ( select id from clinlims.test where description= 'Cristaux (Urine)' ) ;</sql>
            <sql>delete from clinlims.analysis where test_id = ( select id from clinlims.test where description= 'Cristaux (Culot Urinaire)' ) ;</sql>
            <sql>delete from clinlims.test_result where value in ( select cast (id as text) from clinlims.dictionary where dict_entry like 'Oxalate de Ca%' ) ;</sql>
            <sql>delete from clinlims.test_result where value in ( select cast (id as text) from clinlims.dictionary where dict_entry like 'Phosphate Amorphes%' ) ;</sql>
            <sql>delete from clinlims.test_result where value in ( select cast (id as text) from clinlims.dictionary where dict_entry like 'Phosphate Triples%' ) ;</sql>
            <sql>delete from clinlims.test_result where value in ( select cast (id as text) from clinlims.dictionary where dict_entry like 'Phosphate de Ca%' ) ;</sql>
            <sql>delete from clinlims.test_result where value in ( select cast (id as text) from clinlims.dictionary where dict_entry like 'Phosphate de Mg%' ) ;</sql>
            <sql>delete from clinlims.test_result where value in ( select cast (id as text) from clinlims.dictionary where dict_entry like 'Sulfate de Ca%' ) ;</sql>
            <sql>delete from clinlims.test_result where value in ( select cast (id as text) from clinlims.dictionary where dict_entry like 'Urates Amorphes%' ) ;</sql>
            <sql>delete from clinlims.test_result where value in ( select cast (id as text) from clinlims.dictionary where dict_entry like $$Urates d'Ammonium%$$ ) ;</sql>
			<sql>delete from clinlims.test_result where value in ( select cast (id as text) from clinlims.dictionary where dict_entry like 'Acid Urique%' ) ;</sql>
   			<sql>delete from clinlims.dictionary where dict_entry like 'Oxalate de Ca%' ;</sql>
            <sql>delete from clinlims.dictionary where dict_entry like 'Phosphate Amorphes%' ;</sql>
            <sql>delete from clinlims.dictionary where dict_entry like 'Phosphate Triples%' ;</sql>
            <sql>delete from clinlims.dictionary where dict_entry like 'Phosphate de Ca%' ;</sql>
            <sql>delete from clinlims.dictionary where dict_entry like 'Phosphate de Mg%' ;</sql>
            <sql>delete from clinlims.dictionary where dict_entry like 'Sulfate de Ca%' ;</sql>
            <sql>delete from clinlims.dictionary where dict_entry like 'Urates Amorphes%' ;</sql>
            <sql>delete from clinlims.dictionary where dict_entry like $$Urates d'Ammonium%$$ ;</sql>
			<sql>delete from clinlims.dictionary where dict_entry like 'Acid Urique%' ;</sql>
			
			<insert schemaName="clinlims" tableName="dictionary">
                <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                <column name="is_active" value="Y"/>
                <column name="dict_entry" value="Oxalate de Ca"/>
                <column name="lastupdated" valueDate=" now() "/> 
             </insert>
             <insert schemaName="clinlims" tableName="dictionary">
                <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                <column name="is_active" value="Y"/>
                <column name="dict_entry" value="Phosphate Amorphes"/>
                <column name="lastupdated" valueDate=" now() "/> 
             </insert>
             <insert schemaName="clinlims" tableName="dictionary">
                <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                <column name="is_active" value="Y"/>
                <column name="dict_entry" value="Phosphate Triples"/>
                <column name="lastupdated" valueDate=" now() "/> 
             </insert>
             <insert schemaName="clinlims" tableName="dictionary">
                <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                <column name="is_active" value="Y"/>
                <column name="dict_entry" value="Phosphate de Ca"/>
                <column name="lastupdated" valueDate=" now() "/> 
             </insert>
             <insert schemaName="clinlims" tableName="dictionary">
                <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                <column name="is_active" value="Y"/>
                <column name="dict_entry" value="Phosphate de Mg"/>
                <column name="lastupdated" valueDate=" now() "/> 
             </insert>
             <insert schemaName="clinlims" tableName="dictionary">
                <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                <column name="is_active" value="Y"/>
                <column name="dict_entry" value="Sulfate de Ca"/>
                <column name="lastupdated" valueDate=" now() "/> 
             </insert>
             <insert schemaName="clinlims" tableName="dictionary">
                <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                <column name="is_active" value="Y"/>
                <column name="dict_entry" value="Urates Amorphes"/>
                <column name="lastupdated" valueDate=" now() "/> 
             </insert>
             <insert schemaName="clinlims" tableName="dictionary">
                <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                <column name="is_active" value="Y"/>
                <column name="dict_entry" value="Urates d'Ammonium"/>
                <column name="lastupdated" valueDate=" now() "/> 
             </insert>
             <insert schemaName="clinlims" tableName="dictionary">
                <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                <column name="is_active" value="Y"/>
                <column name="dict_entry" value="Acid Urique"/>
                <column name="lastupdated" valueDate=" now() "/> 
             </insert>
			 <loadData file="HaitiCommon/HaitiCommonTestResults3b.csv" schemaName="clinlims" tableName="test_result">
          		<column name="id" header="id" type="NUMERIC"/>
         		<column name="tst_rslt_type" header="result_type" type="STRING"/>
         		<column name="value" header="value" type="NUMERIC"/>
           		<column name="test_id" header="test" type="NUMERIC"/>	
           		<column name="lastupdated" header="lastupdated" type="DATE"/>
       		</loadData> 
</changeSet>
<changeSet author="nixonl" id="32" context="haiti,haitiLNSP">
            <comment>Test Configuration part 6</comment> 
            <insert schemaName="clinlims" tableName="dictionary">
                <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                <column name="is_active" value="Y"/>
                <column name="dict_entry" value="Invalide"/>
                <column name="lastupdated" valueDate=" now() "/> 
             </insert>
            <loadData file="HaitiCommon/HaitiCommonTestResults3c.csv" schemaName="clinlims" tableName="test_result">
          		<column name="id" header="id" type="NUMERIC"/>
         		<column name="tst_rslt_type" header="result_type" type="STRING"/>
         		<column name="value" header="value" type="NUMERIC"/>
           		<column name="test_id" header="test" type="NUMERIC"/>	
           		<column name="lastupdated" header="lastupdated" type="DATE"/>
       		</loadData>     
</changeSet>
<changeSet author="nixonl" id="33" context="haiti,haitiLNSP">
            <comment>Test Configuration part 7</comment>     
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NEG' ) and test_id = ( select id from clinlims.test where description = 'TPHA' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='NEG'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NR' ) and test_id = ( select id from clinlims.test where description = 'TPHA' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NR' ) and test_id = ( select id from clinlims.test where description = 'TPHA' ) );           
            </sql> 
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value = ( select cast (id as text) from clinlims.dictionary where local_abbrev='POSITIF' ) and test_id = ( select id from clinlims.test where description = 'KOH' ) ) " />
                     <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='POSITIF' ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'F POS' ) and test_id = ( select id from clinlims.test where description = 'KOH' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'F POS' ) and test_id = ( select id from clinlims.test where description = 'KOH' ) );           
            </sql> 
            <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Sang Occulte (Selles)' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='++' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert> 
		  	<insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Sang Occulte (Selles)' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='+++' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert> 
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='++' ) and test_id = ( select id from clinlims.test where description = 'Sang Occulte (Selles)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='++'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'F POS' ) and test_id = ( select id from clinlims.test where description = 'Sang Occulte (Selles)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'F POS' ) and test_id = ( select id from clinlims.test where description = 'Sang Occulte (Selles)' ) );           
            </sql> 
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='+++' ) and test_id = ( select id from clinlims.test where description = 'Sang Occulte (Selles)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='+++'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'TRES POS' ) and test_id = ( select id from clinlims.test where description = 'Sang Occulte (Selles)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'TRES POS' ) and test_id = ( select id from clinlims.test where description = 'Sang Occulte (Selles)' ) );           
            </sql> 
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NEG' ) and test_id = ( select id from clinlims.test where description = 'RAA Test' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='NEG'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NR' ) and test_id = ( select id from clinlims.test where description = 'RAA Test' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NR' ) and test_id = ( select id from clinlims.test where description = 'RAA Test' ) );           
            </sql> 
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NEG' ) and test_id = ( select id from clinlims.test where description = 'P24' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='NEG'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NR' ) and test_id = ( select id from clinlims.test where description = 'P24' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NR' ) and test_id = ( select id from clinlims.test where description = 'P24' ) );           
            </sql>
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='POSITIF'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '+' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '+' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) );           
            </sql>
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='POSITIF'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '++' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '++' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) );           
            </sql>
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='POSITIF'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '+++' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '+++' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) );           
            </sql>
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='POSITIF'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'F POS' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'F POS' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) );           
            </sql>
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='POSITIF'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'TRES POS' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'TRES POS' ) and test_id = ( select id from clinlims.test where description = 'Nitrites (Urine)' ) );           
            </sql>
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '+' ) and test_id = ( select id from clinlims.test where description = 'Acétone (Urine)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='+'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'F POS' ) and test_id = ( select id from clinlims.test where description = 'Acétone (Urine)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'F POS' ) and test_id = ( select id from clinlims.test where description = 'Acétone (Urine)' ) );           
            </sql>
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '+' ) and test_id = ( select id from clinlims.test where description = 'Acétone (Urine)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='+'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Acétone (Urine)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Acétone (Urine)' ) );           
            </sql> 
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Hépatite B - HBsAg IgG' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='POSITIF'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where dict_entry='Réactif' ) and test_id = ( select id from clinlims.test where description = 'Hépatite B - HBsAg IgG' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where dict_entry='Réactif' ) and test_id = ( select id from clinlims.test where description = 'Hépatite B - HBsAg IgG' ) );           
            </sql>  
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value in ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NEG' ) and test_id = ( select id from clinlims.test where description = 'Hépatite B - HBsAg IgG' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='NEG'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='NR' ) and test_id = ( select id from clinlims.test where description = 'Hépatite B - HBsAg IgG' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='NR' ) and test_id = ( select id from clinlims.test where description = 'Hépatite B - HBsAg IgG' ) );           
            </sql>  
            <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Hépatite B - HBsAg IgG' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where dict_entry='Invalide' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert> 
		  	<update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '+' ) and test_id = ( select id from clinlims.test where description = 'Mucus (Urine)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='+'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Mucus (Urine)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Mucus (Urine)' ) );           
            </sql>  
            <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Glucose (Urine)' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='+' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert> 
            <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Glucose (Urine)' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='++' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert> 
		  	<insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Glucose (Urine)' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='+++' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert> 
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '+' ) and test_id = ( select id from clinlims.test where description = 'Glucose (Urine)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='+'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Glucose (Urine)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Glucose (Urine)' ) );           
            </sql>
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '++' ) and test_id = ( select id from clinlims.test where description = 'Glucose (Urine)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='++'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='F POS' ) and test_id = ( select id from clinlims.test where description = 'Glucose (Urine)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='F POS' ) and test_id = ( select id from clinlims.test where description = 'Glucose (Urine)' ) );           
            </sql>
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = '+++' ) and test_id = ( select id from clinlims.test where description = 'Glucose (Urine)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='+++'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='TRES POS' ) and test_id = ( select id from clinlims.test where description = 'Glucose (Urine)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='TRES POS' ) and test_id = ( select id from clinlims.test where description = 'Glucose (Urine)' ) );           
            </sql>		  	    
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where dict_entry='Réactif' ) and test_id = ( select id from clinlims.test where description = 'Bioline (syphillis)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where dict_entry='Réactif'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Bioline (syphillis)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='POSITIF' ) and test_id = ( select id from clinlims.test where description = 'Bioline (syphillis)' ) );           
            </sql>
            <update schemaName="clinlims" tableName="result">
                    <column name="test_result_id" valueNumeric=" ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev='NR' ) and test_id = ( select id from clinlims.test where description = 'Bioline (syphillis)' ) ) " />
                    <column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='NR'  ) "/>
                    <where>test_result_id= ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NEG' ) and test_id = ( select id from clinlims.test where description = 'Bioline (syphillis)' ) ) </where>     
            </update>    
            <sql>
                delete from clinlims.test_result where id in ( select id from clinlims.test_result where value= ( select cast (id as text) from clinlims.dictionary where local_abbrev = 'NEG' ) and test_id = ( select id from clinlims.test where description = 'Bioline (syphillis)' ) );           
            </sql>
</changeSet>
<changeSet author="nixonl" id="34" context="haiti,haitiLNSP">
            <comment>Test Configuration part 8a</comment>   
            <insert schemaName="clinlims" tableName="test">
                <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
                <column name="description" value="Zielh Neilsen"/> 
                <column name="name" value="Zielh Neilsen"/>
                <column name="lastupdated" valueDate='now()' /> 
                <column name="is_active" value='Y' /> 
                <column name="is_reportable" value='N' /> 
                <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Bacteria' ) "/> 
                <column name="local_abbrev" value='Zielh Neilsen' />
                <column name="display_key" value="test.zielhNeilsen"/>
			</insert> 
	  		<insert schemaName="clinlims" tableName="sampletype_test">
	         	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
	           	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Crachat' ) "/>
	           	<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'Zielh Neilsen' ) " /> 	
	        </insert>
	        <insert schemaName="clinlims" tableName="test_result">
	           	<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
	           	<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'Zielh Neilsen' ) "/>
	           	<column name="tst_rslt_type" value="A"/> 	
	           	<column name="lastupdated" valueDate='now()' /> 
			 </insert>
			 
		     <update schemaName="clinlims" tableName="test_result"> 
		         <column name="tst_rslt_type" value="M"/> 
		         <where>test_id = ( select id from clinlims.test where description = 'Coccidies (Selles)' )</where>
			 </update>            
</changeSet> 
<changeSet author="nixonl" id="35" context="haiti,haitiLNSP">
            <comment>Test Configuration part 8b</comment> 
			<insert schemaName="clinlims" tableName="test">
                <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
                <column name="description" value="HTLV I et II Blot" /> 
                <column name="name" value="HTLV I et II Blot" />
                <column name="lastupdated" valueDate='now()' /> 
                <column name="is_active" value='Y' /> 
                <column name="is_reportable" value='N' /> 
                <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name = 'Immunology' ) "/> 
                <column name="local_abbrev" value='HTLV I et II Blot' />
                <column name="display_key" value="test.htlvIandIIBlot" />
			</insert> 
	  		<insert schemaName="clinlims" tableName="sampletype_test">
	         	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
	           	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description = 'Plasma' ) "/>
	           	<column name="test_id"  valueNumeric=" ( select id from clinlims.test where description = 'HTLV I et II Blot' ) " /> 	
	        </insert>
	        <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'HTLV I et II Blot' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='POSITIF' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert>
		  	<insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'HTLV I et II Blot' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='NEG' ) "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert>
		  	<insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description = 'HTLV I et II Blot' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where local_abbrev='IND') "/>		
           		<column name="lastupdated" valueDate='now()' /> 
		  	</insert>
</changeSet>
<changeSet author="nixonl" id="36" context="haiti,haitiLNSP">
	 <comment>Updating panel named 'Test de grossesse' </comment>
		<update schemaName="clinlims" tableName="test">
			<column name="local_abbrev" value="BHCG Quant"/>
			<where>local_abbrev = 'βHCG Quant' </where>
		</update>
		<update schemaName="clinlims" tableName="test">
		  	<column name="local_abbrev" value="BHCG Qual"/>
			<where>local_abbrev = 'βHCG Qual' </where>
		</update>
		<update schemaName="clinlims" tableName="panel_item">
              <column name="test_local_abbrev" value="BHCG Quant"/>
               <column name="panel_id"  valueNumeric=" ( select id from clinlims.panel where name='Test de grossesse' ) "/>
              <where>test_local_abbrev = 'βHCG Quant' </where>
	    </update>
	    <update schemaName="clinlims" tableName="panel_item">
              <column name="test_local_abbrev" value="BHCG Qual"/>
               <column name="panel_id"  valueNumeric=" ( select id from clinlims.panel where name='Test de grossesse' ) "/>
              <where>test_local_abbrev = 'βHCG Qual' </where>
	    </update>   
</changeSet>
<changeSet author="nixonl" id="37" context="haiti,haitiLNSP">
	 <comment>Updating panel named 'Test de grossesse' </comment>
		<update schemaName="clinlims" tableName="test">
			<column name="local_abbrev" value="βHCG Quant"/>
			<column name="description" value="βHCG Quant"/>
			<column name="name" value="βHCG Quant"/>
			<where>local_abbrev = 'BHCG Quant' </where>
		</update>
		<update schemaName="clinlims" tableName="test">
		  	<column name="local_abbrev" value="βHCG Qual"/>
		  	<column name="description" value="βHCG Qual"/>
		  	<column name="name" value="βHCG Qual"/>
			<where>local_abbrev = 'BHCG Qual' </where>
		</update>
		<update schemaName="clinlims" tableName="panel_item">
              <column name="test_local_abbrev" value="βHCG Quant"/>
               <column name="panel_id"  valueNumeric=" ( select id from clinlims.panel where name='Test de grossesse' ) "/>
              <where>test_local_abbrev = 'BHCG Quant' </where>
	    </update>
	    <update schemaName="clinlims" tableName="panel_item">
              <column name="test_local_abbrev" value="βHCG Qual"/>
               <column name="panel_id"  valueNumeric=" ( select id from clinlims.panel where name='Test de grossesse' ) "/>
              <where>test_local_abbrev = 'BHCG Qual' </where>
	    </update>   
</changeSet>
<changeSet author="pahill" id="1" context="haiti, haitiLNSP" >
       <comment>Add Role for QC</comment>
       <insert tableName="system_role" schemaName="clinlims">
	    	 <column name="id" valueNumeric=" nextval( 'system_role_seq' ) "/>
             <column name="name" value="Quality control"/>
             <column name="description" value="Able to do QC (e.g. nonconformity)"/>
             <column name="is_grouping_role" value="FALSE"/>
             <column name="grouping_parent" value="NULL"/>
             <column name="display_key" value="role.quality.control"/>	
	    </insert>
</changeSet>
<changeSet author="pahill" id="2" context="haiti, haitiLNSP">
	   <comment>Let QC role execute non-conformity module</comment>
       <loadData file="Haiti_CSV/Haiti_Role_Module_Rev5.csv" schemaName="clinlims" tableName="system_role_module">
             <column name="id" header="id" type="NUMERIC"/>
             <column name="has_select" header="has_select" type="STRING"/>
             <column name="has_add" header="has_add" type="STRING"/>
             <column name="has_update" header="has_update" type="STRING"/>
             <column name="has_delete" header="has_delete" type="STRING"/>
             <column name="system_role_id" header="system_role_id" type="NUMERIC"/>
             <column name="system_module_id" header="system_module_id" type="NUMERIC"/>
       </loadData>
</changeSet>
<changeSet author="pahill" id="4" context="haiti, haitiLNSP" runOnChange="true">
    <comment>Adding analysis status of non-conforming</comment>
    <insert schemaName="clinlims" tableName="status_of_sample">
            <column name="id" valueNumeric=" nextval( 'status_of_sample_seq' ) "/>
            <column name="code" value="1"/>
            <column name="lastupdated" valueDate='now()' />
            <column name="status_type" value="ANALYSIS"/>
            <column name="name" value="NonConforming"/>
            <column name="description" value="Test is for a non-conforming sample-item"/>
            <column name="display_key" value="status.analysis.nonconforming"/>
    </insert>
 </changeSet>
 <changeSet author="pahill" id="5" context="haiti, haitiLNSP">
	<comment>Drop old OpenELIS (domestic) qa_events and reload for Haiti</comment>
	<delete schemaName="clinlims" tableName="qa_event"/>
	<loadData file="Haiti_CSV/Haiti_QA_Events.csv" schemaName="clinlims" tableName="qa_event">
       <column name="id" header="id" type="NUMERIC"/>
       <column name="name" header="name" type="STRING"/>
       <column name="description" header="description" type="STRING"/>
       <column name="lastupdated" header="lastupdated" type="DATE"/>
       <column name="display_key" header="display_key" type="STRING"/>
       <column name="is_holdable" header="is_holdable" type="STRING"/>
	</loadData>
</changeSet>
<changeSet author="paulsc" id="17" context="haiti, haitiLNSP" >
	<comment>Correcting the insertion of NonConforming into status_of_sample table</comment>
	<update schemaName="clinlims" tableName="status_of_sample" >
		<column name="description" value="Test is for a non-conforming sample-item" />
		<where>
			name = 'NonConforming' and status_type='ANALYSIS' 
		</where>
	</update>
	<insert schemaName="clinlims" tableName="status_of_sample" >
		<column name="id" valueNumeric=" nextval( 'status_of_sample_seq' ) " />
		<column name="description" value="The sample is non-conforming" />
		<column name="code" value="1" />
		<column name="status_type" value="SAMPLE" />
		<column name="lastupdated" valueDate=" now() " />
		<column name="name" value="NonConforming" />
		<column name="display_key" value="status.sample.nonConforming" />
	</insert>
</changeSet>
<changeSet author="paulsc" id="18" context="haiti, haitiLNSP" >
	<comment>Activates resultUpdater role</comment>
	<update schemaName="clinlims" tableName="system_role" >
		<column name="active" valueBoolean="true" />
		<where>name='Results modifier'</where>
	</update>
</changeSet>
<changeSet author="paulsc" id="19" context="haiti, haitiLNSP" >
	<comment>Sets the default for "note required on result change" and "role required for result change" to be be true</comment>
	<update schemaName="clinlims" tableName="site_information" >
		<column name="value" value="true" />
		<where>name in ('modify results role', 'modify results note required' ) </where>
	</update>
</changeSet>
<changeSet author="paulsc" id="20" context="haiti, haitiLNSP, ciLNSP" >
	<comment>Bringing Haiti/LNSP into status conformaty</comment>
	<update schemaName="clinlims" tableName="status_of_sample" >
		<column name="description" value="The test has passed all validation and has been accepted as valid" />
		<column name="name" value="Valid" />
		<column name="display_key" value="status.test.valid" />
		<column name="lastupdated" valueDate=" now() " />
		<where>name = 'finished'</where>
	</update>
	<update schemaName="clinlims" tableName="status_of_sample" >
		<column name="description" value="The Biologist did not accept this result as valid" />
		<column name="name" value="Biologist Rejection" />
		<column name="display_key" value="status.test.biologist.reject" />
		<column name="lastupdated" valueDate=" now() " />
		<where>name = 'Invalid Not Signed'</where>
	</update>
	<insert schemaName="clinlims" tableName="status_of_sample" >
		<column name="id" valueNumeric=" nextval( 'status_of_sample_seq' ) " />
		<column name="description" value="Test was requested but then canceled" />
		<column name="code" valueNumeric="1" />
		<column name="status_type" value="ANALYSIS" />
		<column name="name" value="Test Canceled" />
		<column name="display_key" value="status.test.canceled" />
		<column name="lastupdated" valueDate=" now() " />
	</insert>
	<insert schemaName="clinlims" tableName="status_of_sample" >
		<column name="id" valueNumeric=" nextval( 'status_of_sample_seq' ) " />
		<column name="description" value="The results of the test were accepted by technician as being valid" />
		<column name="code" valueNumeric="1" />
		<column name="status_type" value="ANALYSIS" />
		<column name="name" value="Technical Acceptance" />
		<column name="display_key" value="status.test.tech.accepted" />
		<column name="lastupdated" valueDate=" now() " />
	</insert>	
	<insert schemaName="clinlims" tableName="status_of_sample" >
		<column name="id" valueNumeric=" nextval( 'status_of_sample_seq' ) " />
		<column name="description" value="The results of the test were not accepted by the technicain" />
		<column name="code" valueNumeric="1" />
		<column name="status_type" value="ANALYSIS" />
		<column name="name" value="Technical Rejected" />
		<column name="display_key" value="status.test.tech.rejected" />
		<column name="lastupdated" valueDate=" now() " />
	</insert>
</changeSet>
<changeSet author="paulsc" id="21" context="haiti, haitiLNSP" >
	<comment>Sets the default for showing the invalid results icon to false</comment>
	<update schemaName="clinlims" tableName="site_information" >
		<column name="value" value="false" />
		<where>name = 'showValidationFailureIcon' </where>
	</update>
</changeSet>
<changeSet author="paulsc" id="22" context="haiti, haitiLNSP" >
	<comment>Set the default for tech name required for haiti clinical and LNSP to true</comment>
	<update schemaName="clinlims" tableName="site_information" >
		<column name="value" valueBoolean="true" />
		<where>name in ('ResultTechnicianName', 'modify results note required', 'autoFillTechNameBox' )</where>
	</update>
</changeSet>
<changeSet author="paulsc" id="23" context="haiti, haitiLNSP" runAlways="true">
	<comment>Removes duplicate entries in the sampletype_test table</comment>
	<sql>
	delete from clinlims.sampletype_test where id in (select st.id from clinlims.sampletype_test st
		join clinlims.sampletype_test st2 on st.sample_type_id = st2.sample_type_id and st.test_id = st2.test_id and st.id > st2.id)
	</sql>
</changeSet>
<changeSet author="paulsc" id="24" context="haiti,haitiLNSP">
       <comment>Sets modules to roles</comment>
       <insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'LogbookResults:mycrobacteriology' ) "/>
       </insert>
       <insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'LogbookResults:cytobacteriology' ) "/>
       </insert>
       <insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'LogbookResults:molecularBio' ) "/>
       </insert>
       <insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'LogbookResults:liquidBio' ) "/>
       </insert>
       <insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'LogbookResults:endocrin' ) "/>
       </insert>
        <insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'LogbookResults:serology' ) "/>
       </insert>
</changeSet>
<changeSet author="paulsc" id="25" context="haiti,haitiLNSP">
	<comment>Removes '0' as gender value from patient table</comment>
	<update tableName="patient" schemaName="clinlims" >
		<column name="gender" value="null" />
		<where>gender = '0'</where>			
	</update>
</changeSet>
<changeSet author="paulsc" id="26" context="haiti,haitiLNSP">
	<comment>Adds the module workplan:panel to Results entry role</comment>
        <insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'Workplan:panel' ) "/>
       </insert>
	
</changeSet>
<changeSet author="paulsc" id="27" context="haiti,haitiLNSP" >
	<comment>Sets flag for using pop-up when the result is out of valid range to true</comment>
	<update tableName="site_information" schemaName="clinlims">
		<column name="value" value="true" />
		<where>name = 'alertWhenInvalidResult'</where>
	</update>
</changeSet>
<changeSet author="paulsc" id="28" context="haiti,haitiLNSP">
	<comment>Adds the module workplan:virology and mycrobacteriolgy to Results entry role</comment>
	    <insert tableName="system_module" schemaName="clinlims">
	    	<column name="id" valueNumeric=" nextval( 'system_module_seq' ) "></column>
		    <column name="name" value="Workplan:virologie" />
		    <column name="description" value="workplan-unit-virology" />
		    <column name="has_select_flag" value="Y" />
		    <column name="has_add_flag" value="Y" />
		    <column name="has_update_flag" value="Y" />
		    <column name="has_delete_flag" value="Y" />
		 </insert>
        <insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'Workplan:molecularBio' ) "/>
       </insert>
		<insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'Workplan:virologie' ) "/>
       </insert>
	
</changeSet>
<changeSet author="paulsc" id="29" context="haiti,haitiLNSP">
	<comment>Adds the module workplan:virology and mycrobacteriolgy to Results entry role</comment>
	    <insert tableName="system_module" schemaName="clinlims">
	    	<column name="id" valueNumeric=" nextval( 'system_module_seq' ) "></column>
		    <column name="name" value="LogbookResults:virologie" />
		    <column name="description" value="results-section-virology" />
		    <column name="has_select_flag" value="Y" />
		    <column name="has_add_flag" value="Y" />
		    <column name="has_update_flag" value="Y" />
		    <column name="has_delete_flag" value="Y" />
		 </insert>
        <insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'LogbookResults:virologie' ) "/>
       </insert>
</changeSet>
<changeSet author="paulsc" id="30" context="haiti,haitiLNSP">
	<comment>Sets test_section inactive</comment>
	<update tableName="test_section">
		<column name="is_active" value='N' />
		<where>sort_order > 2000</where>
	</update>
</changeSet>
<changeSet author="paulsc" id="31" context="haiti,haitiLNSP">
  <insert schemaName="clinlims" tableName="system_role_module">
             <column name="id" valueNumeric=" nextVal( 'system_user_module_seq' ) "/>
             <column name="has_select" value="Y"/>
             <column name="has_add" value="Y"/>
             <column name="has_update" value="Y"/>
             <column name="has_delete" value="Y"/>
             <column name="system_role_id" valueNumeric=" ( select id from system_role where name = 'Results entry' ) "/>
             <column name="system_module_id" valueNumeric=" ( select id from system_module where name = 'LogbookResults:serologie' ) "/>
       </insert>
</changeSet>
</databaseChangeLog>
